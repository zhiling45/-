<!DOCTYPE html><html lang="zh-CN"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>贪吃蛇 - Snake</title>
<style>
:root{--bg:#0f172a;--fg:#e2e8f0;--accent:#22d3ee}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"PingFang SC","Microsoft YaHei",sans-serif;display:grid;place-items:center;min-height:100vh;padding:16px}
.wrap{width:100%;max-width:540px;display:grid;gap:12px}h1{margin:0;font-size:20px;text-align:center}
.top{display:flex;justify-content:space-between;align-items:center;gap:8px}
.stats{display:flex;gap:10px;font-size:14px;opacity:.9}.btn{background:#1f2937;color:var(--fg);border:1px solid #334155;padding:8px 12px;border-radius:10px}
canvas{width:100%;background:#020617;border-radius:14px;border:1px solid #334155;aspect-ratio:1;touch-action:none}
.controls{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:4px;user-select:none}
.pad{background:#111827;border:1px solid #374151;border-radius:12px;padding:14px;text-align:center;font-weight:700}
.pad:active{transform:scale(.98);border-color:var(--accent)}footer{text-align:center;font-size:12px;opacity:.6}
.pill{padding:2px 8px;border-radius:999px;border:1px solid #334155}
</style>
<body><div class="wrap"><h1>🐍 贪吃蛇 Snake</h1>
<div class="top"><div class="stats">
<div class="pill">分数 <span id="score">0</span></div>
<div class="pill">最高 <span id="best">0</span></div>
<div class="pill">速度 <span id="speed">1x</span></div></div>
<div><button class="btn" id="btnPause">暂停</button>
<button class="btn" id="btnRestart">重开</button></div></div>
<canvas id="board" width="420" height="420"></canvas>
<div class="controls" id="touchControls"><div></div>
<button class="pad" data-dir="up">↑</button><div></div>
<button class="pad" data-dir="left">←</button>
<button class="pad" data-dir="down">↓</button>
<button class="pad" data-dir="right">→</button><div></div>
<button class="pad" id="padPause">暂停/继续</button><div></div></div>
<footer>键盘：↑↓←→ / WASD；P 暂停；R 重开。</footer></div>
<script>
(()=>{const CELL=21,SIZE=21,TICK_BASE=120,c=document.getElementById('board'),x=c.getContext('2d'),
S=document.getElementById('score'),B=document.getElementById('best'),V=document.getElementById('speed'),
p=document.getElementById('btnPause'),r=document.getElementById('btnRestart'),tp=document.getElementById('padPause');
let best=+localStorage.getItem('snake_best')||0;B.textContent=best;let sn,dir,ndir,food,tick,run,score,spd;
function reset(){sn=[{x:10,y:10},{x:9,y:10},{x:8,y:10}],dir={x:1,y:0},ndir={x:1,y:0},food=spawn(),tick=0,run=true,score=0,spd=1,ui()}
function ui(){S.textContent=score;B.textContent=best;V.textContent=spd+'x';p.textContent=run?'暂停':'继续';tp.textContent=run?'暂停':'继续'}
function spawn(){for(;;){const p={x:Math.floor(Math.random()*SIZE),y:Math.floor(Math.random()*SIZE)};if(!sn.some(s=>s.x===p.x&&s.y===p.y))return p}}
function step(){if(!run)return;tick++;const s=Math.max(40,TICK_BASE-(spd-1)*15);if(tick%Math.floor(s/10)!==0)return;
dir=ndir;const h={x:sn[0].x+dir.x,y:sn[0].y+dir.y}; if(h.x<0||h.x>=SIZE||h.y<0||h.y>=SIZE)return over();
if(sn.some(seg=>seg.x===h.x&&seg.y===h.y))return over(); sn.unshift(h);
if(h.x===food.x&&h.y===food.y){score++;if(score%5===0&&spd<6)spd++;food=spawn()}else sn.pop();draw();ui()}
function over(){run=false;best=Math.max(best,score);localStorage.setItem('snake_best',best);ui();draw(true)}
function draw(over=false){x.fillStyle='#020617',x.fillRect(0,0,c.width,c.height);
for(let y=0;y<SIZE;y++)for(let z=0;z<SIZE;z++){x.strokeStyle='rgba(51,65,85,.25)';x.strokeRect(z*CELL,y*CELL,CELL,CELL)}
x.fillStyle='#22d3ee',rect(food.x*CELL+3,food.y*CELL+3,CELL-6,CELL-6,6,true);
sn.forEach((s,i)=>rect(s.x*CELL+2,s.y*CELL+2,CELL-4,CELL-4,6,true,i? '#34d399':'#eab308'));
if(!run&&over){x.fillStyle='rgba(2,6,23,.6)';x.fillRect(0,0,c.width,c.height);x.fillStyle='#e2e8f0';x.font='bold 28px system-ui';x.textAlign='center';
x.fillText('游戏结束',c.width/2,c.height/2-10);x.font='16px system-ui';x.fillText('按 R 重开',c.width/2,c.height/2+16)}}
function rect(a,b,w,h,r,fill=true,color='#34d399'){x.beginPath();x.moveTo(a+r,b);x.arcTo(a+w,b,a+w,b+h,r);x.arcTo(a+w,b+h,a,b+h,r);
x.arcTo(a,b+h,a,b,r);x.arcTo(a,b,a+w,b,r);x.closePath();x.fillStyle=color;if(fill)x.fill()}
addEventListener('keydown',e=>{const k=e.key.toLowerCase();if(k==='arrowup'||k==='w')turn(0,-1);
if(k==='arrowdown'||k==='s')turn(0,1);if(k==='arrowleft'||k==='a')turn(-1,0);if(k==='arrowright'||k==='d')turn(1,0);
if(k==='p')toggle();if(k==='r')reset()});function turn(xd,yd){if(xd===-dir.x&&yd===-dir.y)return;ndir={x:xd,y:yd}}
function toggle(){run=!run;ui()} p.onclick=toggle;r.onclick=reset;tp.onclick=toggle;
document.getElementById('touchControls').addEventListener('click',e=>{const d=e.target.dataset.dir;
if(d==='up')turn(0,-1);if(d==='down')turn(0,1);if(d==='left')turn(-1,0);if(d==='right')turn(1,0)});
reset();function loop(){step();requestAnimationFrame(loop)}draw();requestAnimationFrame(loop)})();
</script></body></html>
